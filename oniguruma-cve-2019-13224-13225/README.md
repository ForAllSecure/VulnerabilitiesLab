# Oniguruma Regex CVE-2019-13224 and CVE-2019-13224

This repo replicates findings [CVE-2019-13224](https://nvd.nist.gov/vuln/detail/CVE-2019-13224) and [CVE-2019-13225](https://nvd.nist.gov/vuln/detail/CVE-2019-13225), a use after free bug and NULL pointer dereference with the potential for information disclosure and control flow hijacking ([CVSS Score](https://nvd.nist.gov/vuln-metrics/cvss): 9.8 and 6.5) in Oniguruma. Oniguruma is a popular regex library used internally to Ruby, PHP, and Rust used for its high customizability.

 We reported this bug responsibly to the maintainers, fixed [here](https://github.com/kkos/oniguruma/commit/0f7f61ed1b7b697e283e37bd2d731d0bd57adb55) and [here](https://github.com/kkos/oniguruma/commit/c509265c5f6ae7264f7b8a8aae1cfa5fc59d108c).

## To build

Assuming you just want to build the docker image, run:

```bash
docker build -t forallsecure/oniguruma-cve-2019-13224-13225 .
```

## Get from Dockerhub

If you don't want to build locally, you can pull a pre-built image
directly from dockerhub:

```bash
docker pull forallsecure/oniguruma-cve-2019-13224-13225
```


## Run under Mayhem

Change to the `oniguruma-cve-2019-13224-13225` folder and run:

```bash
mayhem run mayhem/oniguruma
```

and watch Mayhem replicate the bug! This bug takes seconds!

## Run locally

You can run this locally by running the libfuzzer harness or standalone harness
with qemu-afl inside the docker container.

## POC

We have included a proof of concept output under the `poc`
directory.

> Note: Fuzzing has some degree of non-determinism, so when you run
yourself you may not get exactly this file.  This is expected; your
output should still trigger the Oniguruma regex bug.

This bug was originally found by ForAllSecure employee [Mark Griffin](https://blog.forallsecure.com/author/mark-griffin).
As such, this bug has since been fixed [here](https://github.com/kkos/oniguruma/commit/0f7f61ed1b7b697e283e37bd2d731d0bd57adb55)
and [here](https://github.com/kkos/oniguruma/commit/c509265c5f6ae7264f7b8a8aae1cfa5fc59d108c)
by project maintainers.
