#include <unistd.h>
#include <fcntl.h>
#include <stdio.h>
#include <stdint.h>

static const size_t kMaxInputSize = 1 << 20;
static uint8_t InputBuf[kMaxInputSize];

extern int LLVMFuzzerTestOneInput(const uint8_t * Data, size_t Size);

int main(int argc, char **argv) {
  if (argc != 2) {
    fprintf(stderr,
      "======================= INFO =========================\n"
      "This binary is built for running without instrumentation.\n"
      "To run the target function on individual input execute this:\n"
      "  %s INPUT_FILE\n"
      "To fuzz with afl-fuzz execute this:\n"
      "  afl-fuzz -Q [afl-flags] -- %s @@\n"
      "======================================================\n",
      argv[0], argv[0]);
      return -1;
  }

  int fd = open(argv[1], 0);
  if (fd == -1) {
    printf("USAGE: %s INPUT_FILE\n", argv[0]);
    return -1;
  }

  ssize_t bytes_read = read(fd, InputBuf, kMaxInputSize);
  close(fd);
  if (bytes_read >= 0)
    return LLVMFuzzerTestOneInput(InputBuf, bytes_read);
  else
    return -1;
}
