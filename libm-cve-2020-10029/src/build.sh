#!/bin/bash

GLIBC=/src/glibc-2.31

cd $GLIBC/build && ../configure --prefix=/usr && make -j$(nproc)

cd /build/
python3 generate_function_calls.py >function_calls.h

gcc \
  -Wl,-rpath=${GLIBC}:\
${GLIBC}/math:\
${GLIBC}/elf:\
${GLIBC}/dlfcn:\
${GLIBC}/nss:\
${GLIBC}/nis:\
${GLIBC}/rt:\
${GLIBC}/resolv:\
${GLIBC}/crypt:\
${GLIBC}/nptl:\
${GLIBC}/dfp \
  -Wl,--dynamic-linker=${GLIBC}/elf/ld.so \
  -static -o /build/libm-tester /build/libm-tester.c $GLIBC/build/math/libm.a 
