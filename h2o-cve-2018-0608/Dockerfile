FROM ubuntu

RUN export DEBIAN_FRONTEND="noninteractive" && \
    apt-get update && \
    apt-get install -y clang cmake build-essential git libssl-dev zlib1g-dev

WORKDIR /h2o
RUN git clone https://github.com/h2o/h2o . && \
    git checkout 69506c9e2defa4922f62f389c76d89e9274b3cc1 && \
    git checkout HEAD^

RUN mkdir build && cd build && \
    CC=clang CXX=clang++ cmake -E env CXXFLAGS="-fsanitize=address" cmake .. && make

WORKDIR /fuzz
RUN mv /h2o/build/h2o .
COPY h2o.conf .
